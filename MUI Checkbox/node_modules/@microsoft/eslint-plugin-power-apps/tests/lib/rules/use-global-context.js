// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

"use strict";

//------------------------------------------------------------------------------
// Requirements
//------------------------------------------------------------------------------

const rule = require("../../../lib/rules/use-global-context");
const RuleTester = require("eslint").RuleTester;

//------------------------------------------------------------------------------
// Helpers
//------------------------------------------------------------------------------

const ruleTester = new RuleTester();

ruleTester.run("use-global-context", rule, {
    valid: [
        `    // VALID: XrmPage
            var telephoneAttr = Xrm.Page.data.entity.attributes.getByName('telephone1').getValue();
            console.log("get telephone1 with Xrm.Page: " + telephoneAttr);
            
            var firstName = Xrm.Page.getAttribute("firstname").getValue();
            var lastName = Xrm.Page.getAttribute("lastname").getValue();
            console.log(firstName + " " + lastName);
            
            Xrm.Page.data;
            Xrm.Page.data.entity.attributes;
            Xrm.Page.ui;
            Xrm.Page.ui.controls;
            Xrm.Page.getControl("sampleControl");
            Xrm.Page.ui.navivation.items;
            Xrm.Page.ui.formSelector.items;
            Xrm.Page.ui.formSelector.items.getId();
            Xrm.Page.ui.tabs;
            Xrm.Page.ui.tabs.getDisplayState();
            Xrm.Page.ui.tabs.sections;
        `
    ],
    invalid: [
        {
            code:
            `   // INVALID: XrmPage
                var myUrl = parent.Xrm.Page.context.getClientUrl();
                var myUrl = Xrm.Page.context.getClientUrl();
                var myUrl = window.Xrm.Page.context.getClientUrl();
                var myUrl = parent.parent.Xrm.Page.context.getClientUrl();
                var myUrl = window.opener.Xrm.Page.context.getClientUrl();
                var myUrl = window.self.Xrm.Page.context.getClientUrl();

                var page = Xrm.Page;
                page.context.client = myClientObject;
                
                var username = null;
                username = Xrm.Page.context.getUserName();
            `,
            errors: [
                { line: 2 },
                { line: 3 },
                { line: 4 },
                { line: 5 },
                { line: 6 },
                { line: 7 },
                { line: 10 },
                { line: 13 }
            ]
        }
    ]
});
