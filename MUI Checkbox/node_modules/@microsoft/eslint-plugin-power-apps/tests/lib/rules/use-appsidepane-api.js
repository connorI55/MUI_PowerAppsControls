// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

"use strict";

//------------------------------------------------------------------------------
// Requirements
//------------------------------------------------------------------------------

const rule = require("../../../lib/rules/use-appsidepane-api");
const RuleTester = require("eslint").RuleTester;

//------------------------------------------------------------------------------
// CONSTANTS
//------------------------------------------------------------------------------

const MESSAGE_ID = "message1";

//------------------------------------------------------------------------------
// Helpers
//------------------------------------------------------------------------------

const ruleTester = new RuleTester({ parserOptions: { ecmaVersion: 6 } });

ruleTester.run("use-appsidepane-api", rule, {
    valid: [
        // Valid v9 Xrm nav APIs
        `    // VALID
            Xrm.App.sidePanes.createPane({
                title: "Reservations",
                imageSrc: "WebResources/sample_reservation_icon",
                paneId: "ReservationList",
                canClose: false
            });
        `,
        `   //VALID
            this.loadPanel();
            loadPanel();
        `,
        `function UpdatedCreatePane(executionContext){
            //https://learn.microsoft.com/en-us/power-apps/developer/model-driven-apps/clientapi/create-app-side-panes
            Xrm.App.sidePanes.createPane({
                title: "Reservations",
                imageSrc: "WebResources/sample_reservation_icon",
                paneId: "ReservationList",
                canClose: false
            }).then((pane) => {
                pane.navigate({
                    pageType: "entitylist",
                    entityName: "sample_reservation",
                })
            });
        }`
    ],
    invalid: [
        // StandardAPIFormat
        {
            code:
                `    // INVALID: StandardAPIFormat
                 Xrm.Panel.loadPanel("http://bing.com","my title");

            `,
            errors: [
                { messageId: MESSAGE_ID, line: 2 }
            ]
        }
    ]
});
