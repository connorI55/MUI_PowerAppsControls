// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

"use strict";

//------------------------------------------------------------------------------
// Requirements
//------------------------------------------------------------------------------

const rule = require("../../../lib/rules/use-relative-uri");
const RuleTester = require("eslint").RuleTester;

//------------------------------------------------------------------------------
// Helpers
//------------------------------------------------------------------------------

const ruleTester = new RuleTester();
const ruleError = { messageId: "message1" };
const xrmPageContextClientUrl = "https://org.crm.dynamics.com";
const discoHost = "https://disco.crm.dynamics.com";

ruleTester.run("use-relative-uri", rule, {
    valid: [
        "var clientUrl = '" + xrmPageContextClientUrl + "'; var webApiData = clientUrl + '/api/data/v8.1/accounts';",
        "var clientUrl = '" + xrmPageContextClientUrl + "'; var orgService = clientUrl + '/XRMServices/2011/Organization.svc';",
        "var clientUrl = '" + xrmPageContextClientUrl + "'; var orgWebService = clientUrl + '/XRMServices/2011/Organization.svc/Web';",
        "var clientUrl = '" + xrmPageContextClientUrl + "'; var orgDataService = clientUrl + '/XRMServices/2011/OrganizationData.svc';",
        "var discoHost = '" + discoHost + "'; var webApiDisco = discoHost + '/api/discovery/v8.1/Instances';",
        "var discoHost = '" + discoHost + "'; var discoService = discoHost + '/XRMServices/2011/Discovery.svc';"
    ],
    invalid: [
        {
            code: "var webApiData = 'https://orgname.crm.dynamics.com/api/data/v8.1/accounts';",
            errors: [ruleError],
            output: "var webApiData = \"/api/data/v8.1/accounts\";"
        },
        {
            code: "var webApiDisco = 'https://orgname.crm.dynamics.com/api/discovery/v8.1/Instances';",
            errors: [ruleError],
            output: "var webApiDisco = \"/api/discovery/v8.1/Instances\";"
        },
        {
            code: "var orgService = 'http://servername/orgname/XRMServices/2011/Organization.svc';",
            errors: [ruleError],
            output: "var orgService = \"/XRMServices/2011/Organization.svc\";"
        },
        {
            code: "var orgWebService = 'http://servername/orgname/XRMServices/2011/Organization.svc/Web';",
            errors: [ruleError],
            output: "var orgWebService = \"/XRMServices/2011/Organization.svc/Web\";"
        },
        {
            code: "var orgDataService = 'http://servername/orgname/XRMServices/2011/OrganizationData.svc';",
            errors: [ruleError],
            output: "var orgDataService = \"/XRMServices/2011/OrganizationData.svc\";"
        },
        {
            code: "var discoService = 'http://servername/orgname/XRMServices/2011/Discovery.svc';",
            errors: [ruleError],
            output: "var discoService = \"/XRMServices/2011/Discovery.svc\";"
        },
        {
            code: "var crmService = 'http://servername/orgname/MSCRMServices/2007/CrmService.asmx';",
            errors: [ruleError],
            output: "var crmService = \"/MSCRMServices/2007/CrmService.asmx\";"
        }
    ]
});
