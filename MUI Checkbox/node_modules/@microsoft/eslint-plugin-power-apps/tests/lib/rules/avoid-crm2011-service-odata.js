// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

"use strict";

//------------------------------------------------------------------------------
// Requirements
//------------------------------------------------------------------------------

const rule = require("../../../lib/rules/avoid-crm2011-service-odata");
const RuleTester = require("eslint").RuleTester;

//------------------------------------------------------------------------------
// Helpers
//------------------------------------------------------------------------------

const ruleTester = new RuleTester();
const ruleError = { messageId: "message2" };
const xrmPageContextClientUrl = "https://org.crm.dynamics.com";

ruleTester.run("avoid-crm2011-service-odata", rule, {
    valid: [
        // Absolute URI
        "var webApiService = 'https://orgname.crm.dynamics.com/api/data/v8.1/accounts';",

        // Relative URI
        "var clientUrl = '" + xrmPageContextClientUrl + "'; var webApiService = xrmPageContextClientUrl + '/api/data/v8.1/accounts';"
    ],
    invalid: [
        // Absolute URIs
        {
            code: "var orgDataOnlineBase = 'http://orgname.crm.dynamics.com/XRMServices/2011/OrganizationData.svc';",
            errors: [ruleError]
        },
        {
            code: "var orgDataOnPrem = 'http://servername/orgname/XRMServices/2011/OrganizationData.svc';",
            errors: [ruleError]
        },
        {
            code: "var orgDataOnlineEntitySet = 'http://orgname.crm.dynamics.com/XRMServices/2011/OrganizationData.svc/AccountSet';",
            errors: [ruleError]
        },
        // Different casing
        {
            code: "var orgDataOnlineBase = 'http://orgname.crm.dynamics.com/XRMservices/2011/Organizationdata.svc';",
            errors: [ruleError]
        },
        // Relative URIs
        {
            code: "var clientUrl = '" + xrmPageContextClientUrl + "'; var orgDataBase = xrmPageContextClientUrl + '/XRMServices/2011/OrganizationData.svc';",
            errors: [ruleError]
        },
        {
            code: "var clientUrl = '" + xrmPageContextClientUrl + "'; var orgDataEntitySet = xrmPageContextClientUrl + '/XRMServices/2011/OrganizationData.svc/AccountSet';",
            errors: [ruleError]
        },
        // Absolute URIs with unformatted
        {
            code: "var orgDataOnlineBase = 'http://orgname.crm.dynamics.com/XRMServices/2011/OrganizationData.svc';",
            errors: [{ line: 1 }],
            options: [ "unformatted" ]
        },
        // Relative URIs with unformatted
        {
            code: "var clientUrl = '" + xrmPageContextClientUrl + "'; var orgDataBase = xrmPageContextClientUrl + '/XRMServices/2011/OrganizationData.svc';",
            errors: [{ line: 1 }],
            options: [ "unformatted" ]
        }
    ]
});
