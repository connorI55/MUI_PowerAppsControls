// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

"use strict";

//------------------------------------------------------------------------------
// Requirements
//------------------------------------------------------------------------------

const rule = require("../../../lib/rules/use-navigation-api");
const RuleTester = require("eslint").RuleTester;

//------------------------------------------------------------------------------
// CONSTANTS
//------------------------------------------------------------------------------

const MESSAGE_ID = "message1";
const MESSAGE_ID_2 = "message2";

//------------------------------------------------------------------------------
// Helpers
//------------------------------------------------------------------------------

const ruleTester = new RuleTester();

ruleTester.run("use-navigation-api", rule, {
    valid: [
        // Valid v9 Xrm nav APIs
        `    // VALID
             Xrm.Utility.closeProgressIndicator();
             Xrm.Utility.getResourceString();
        `,
        `   //VALID
            alertDialog();
            openWebResourceCustom();
        `
    ],
    invalid: [
        // StandardAPIFormat
        {
            code:
                `    // INVALID: StandardAPIFormat
                 Xrm.Utility.alertDialog("Alert message", CallbackFunction);
                 Xrm.Utility.alertDialog("Alert message2", CallbackFunction2).then(DoSomethingElse);
                 Xrm.Utility.confirmDialog("Alert message", OkCallbackFunction, CancelCallbackFunction);
                 Xrm.Utility.openEntityForm("EntityFormName");
                 Xrm.Utility.openQuickCreate("QuickCreateEntityName");
                 Xrm.Utility.openWebResource("WebResourceName", "sample data", 100, 100);
                 window.Xrm.Utility.openEntityForm("EntityFormName2");
                 window.parent.Xrm.Utility.openEntityForm("EntityFormName2");
                 parent.Xrm.Utility.openEntityForm("EntityFormName2");
                 var func = function() {};
                 func();
                 
                var options = {
                    dialogName: 'custom',
                    position: 1,
                };
                var data = {
                    id_ID: '00000000-0000-0000-0000-000000000000',
                    id_Type: 1
                }
                Xrm.Navigation.openDialog("CustomDialog", options, data);
            `,
            errors: [
                { messageId: MESSAGE_ID, line: 2 },
                { messageId: MESSAGE_ID, line: 3 },
                { messageId: MESSAGE_ID, line: 4 },
                { messageId: MESSAGE_ID, line: 5 },
                { messageId: MESSAGE_ID, line: 6 },
                { messageId: MESSAGE_ID, line: 7 },
                { messageId: MESSAGE_ID, line: 8 },
                { messageId: MESSAGE_ID, line: 9 },
                { messageId: MESSAGE_ID, line: 10 },
                { messageId: MESSAGE_ID_2, line: 22 }
            ]
        }
    ]
});
