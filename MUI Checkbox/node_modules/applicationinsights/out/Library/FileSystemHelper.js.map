{"version":3,"file":"FileSystemHelper.js","sourceRoot":"","sources":["../../Library/FileSystemHelper.ts"],"names":[],"mappings":"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","sourcesContent":["import * as fs from \"fs\";\r\nimport path = require(\"path\");\r\nimport { promisify } from \"util\";\r\nimport Logging = require(\"./Logging\");\r\n\r\nexport const statAsync = promisify(fs.stat);\r\nexport const lstatAsync = promisify(fs.lstat);\r\nexport const mkdirAsync = promisify(fs.mkdir);\r\nexport const accessAsync = promisify(fs.access);\r\nexport const appendFileAsync = promisify(fs.appendFile);\r\nexport const writeFileAsync = promisify(fs.writeFile);\r\nexport const readFileAsync = promisify(fs.readFile);\r\nexport const readdirAsync = promisify(fs.readdir);\r\nexport const unlinkAsync = promisify(fs.unlink);\r\n\r\n/**\r\n * Validate directory exists.\r\n */\r\nexport const confirmDirExists = async (directory: string): Promise<void> => {\r\n    try {\r\n        const stats = await lstatAsync(directory);\r\n        if (!stats.isDirectory()) {\r\n            throw new Error(\"Path existed but was not a directory\");\r\n        }\r\n    } catch (err) {\r\n        if (err && err.code === \"ENOENT\") {\r\n            try {\r\n                await mkdirAsync(directory);\r\n            } catch (mkdirErr) {\r\n                if (mkdirErr && mkdirErr.code !== \"EEXIST\") {\r\n                    // Handle race condition by ignoring EEXIST\r\n                    throw mkdirErr;\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\n/**\r\n * Computes the size (in bytes) of all files in a directory at the root level. Asynchronously.\r\n */\r\nexport const getShallowDirectorySize = async (directory: string): Promise<number> => {\r\n    let totalSize = 0;\r\n    try {\r\n        // Get the directory listing\r\n        const files = await readdirAsync(directory);\r\n        // Query all file sizes\r\n        for (const file of files) {\r\n            const fileStats = await statAsync(path.join(directory, file));\r\n            if (fileStats.isFile()) {\r\n                totalSize += fileStats.size;\r\n            }\r\n        }\r\n    } catch {\r\n        Logging.warn(`Failed to get directory size for ${directory}`);\r\n    }\r\n    return totalSize;\r\n};\r\n\r\n/**\r\n* Computes the size (in bytes) of all files in a directory at the root level. Synchronously.\r\n*/\r\nexport const getShallowDirectorySizeSync = (directory: string): number => {\r\n    let totalSize = 0;\r\n    try {\r\n        let files = fs.readdirSync(directory);\r\n        for (let i = 0; i < files.length; i++) {\r\n            totalSize += fs.statSync(path.join(directory, files[i])).size;\r\n        }\r\n    } catch {\r\n        Logging.warn(`Failed to get directory size synchronously for ${directory}`)\r\n    }\r\n    return totalSize\r\n}\r\n\r\n/**\r\n* Computes the size (in bytes) of a file asynchronously. Returns -1 if the file does not exist.\r\n*/\r\nexport const getShallowFileSize = async (filePath: string): Promise<number> => {\r\n    try {\r\n        const fileStats = await statAsync(filePath);\r\n        if (fileStats.isFile()) {\r\n            return fileStats.size;\r\n        }\r\n    } catch {\r\n        Logging.warn(`Failed to get file size for ${filePath}`);\r\n        return -1;\r\n    }\r\n}\r\n\r\n"]}